<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Photo Editor â€” ajmalanfaal</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --card-bg:#fff;
      --page-bg:#f5f7fa;
      --accent:#000;
      --muted:#777;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body {
      margin: 0;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--page-bg);
      color: #222;
      -webkit-font-smoothing:antialiased;
    }

    header{
      background: var(--card-bg);
      border-bottom: 1px solid #e8e8e8;
      padding: 22px;
      text-align:center;
      font-size:28px;
      font-weight:700;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    }

    .page {
      max-width: 1050px;
      margin: 28px auto;
      padding: 20px;
    }

    .card{
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 22px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.07);
    }

    .top {
      display:flex;
      gap:20px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }

    .uploader {
      flex: 1 1 320px;
      text-align:center;
    }
    input[type=file]{
      width:100%;
      max-width:360px;
      padding:16px 14px;
      font-size:18px;
      border-radius:10px;
      border:1px solid #ddd;
      background:#fafafa;
    }

    /* editor area */
    .editor {
      display:flex;
      gap:20px;
      margin-top:22px;
      flex-wrap:wrap;
      align-items:flex-start;
      justify-content:center;
    }

    .canvas-wrap{
      flex: 1 1 540px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:12px;
      border-radius:10px;
      background:#fafafa;
      min-height:320px;
    }

    canvas{
      max-width:100%;
      border-radius:10px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      display:block;
      height:auto;
    }

    /* controls */
    .controls {
      width:340px;
      flex: 0 0 340px;
    }

    .section-title {
      font-size:18px;
      font-weight:700;
      margin:14px 0;
    }

    .grid-buttons{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:12px;
    }

    button{
      background:var(--accent);
      color:#fff;
      border:none;
      padding:14px 12px;
      font-size:16px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
    }
    button.ghost{
      background:#fff;
      color:var(--accent);
      border:1px solid #ddd;
      font-weight:600;
    }
    button.wide{
      grid-column: 1 / -1;
      min-height:48px;
    }

    .sliders{
      background:#fff;
      padding:14px;
      border-radius:10px;
      border:1px solid #eee;
    }
    .control-row{
      margin-bottom:12px;
    }
    label{
      display:block;
      font-weight:600;
      margin-bottom:6px;
    }
    input[type="range"]{
      width:100%;
    }
    .small{
      font-size:14px;
      color:var(--muted);
      margin-top:8px;
    }

    .footer{
      text-align:center;
      margin-top:18px;
      color:var(--muted);
      font-size:15px;
    }

    /* mobile adjustments */
    @media (max-width:920px){
      .controls{width:100%}
      .grid-buttons{grid-template-columns:repeat(2,1fr)}
    }
  </style>
</head>
<body>
  <header>ðŸ“¸ Photo Editor â€” Made by <strong>ajmalanfaal</strong></header>

  <div class="page">
    <div class="card">
      <div class="top">
        <div class="uploader">
          <input id="upload" type="file" accept="image/*">
          <div class="small">Choose a photo from your device (works on mobile)</div>
        </div>

        <div style="flex:1 1 320px; text-align:right;">
          <div class="small" style="margin-bottom:8px; font-weight:700">Quick tips</div>
          <div class="small">Use sliders to adjust. Press Reset to clear. Download to save.</div>
        </div>
      </div>

      <div class="editor">
        <div class="canvas-wrap">
          <canvas id="canvas"></canvas>
        </div>

        <div class="controls">
          <div class="section">
            <div class="section-title">ðŸŽ¨ Preset Filters</div>
            <div class="grid-buttons">
              <button onclick="setPreset('none')">Original</button>
              <button onclick="setPreset('grayscale(100%)')">Grayscale</button>
              <button onclick="setPreset('sepia(100%)')">Sepia</button>
              <button onclick="setPreset('invert(100%)')">Invert</button>
              <button onclick="setPreset('contrast(150%) brightness(105%) saturate(120%)')">Vintage</button>
              <button onclick="setPreset('contrast(120%) saturate(130%)')">Punch</button>
            </div>
          </div>

          <div class="section" style="margin-top:14px;">
            <div class="section-title">ðŸŽš Adjustments</div>
            <div class="sliders">
              <div class="control-row">
                <label for="brightness">Brightness <span id="brightnessVal">100%</span></label>
                <input id="brightness" type="range" min="50" max="150" value="100">
              </div>

              <div class="control-row">
                <label for="contrast">Contrast <span id="contrastVal">100%</span></label>
                <input id="contrast" type="range" min="50" max="200" value="100">
              </div>

              <div class="control-row">
                <label for="saturation">Saturation <span id="saturationVal">100%</span></label>
                <input id="saturation" type="range" min="0" max="300" value="100">
              </div>

              <div class="control-row">
                <label for="hue">Hue Rotation <span id="hueVal">0Â°</span></label>
                <input id="hue" type="range" min="0" max="360" value="0">
              </div>

              <div class="control-row">
                <label for="blur">Blur <span id="blurVal">0px</span></label>
                <input id="blur" type="range" min="0" max="10" value="0" step="0.5">
              </div>

              <div class="control-row">
                <label for="tintColor">Tint Color & Strength</label>
                <input id="tintColor" type="color" value="#ff7a7a" style="width:48px;height:40px;padding:2px;border-radius:6px;border:1px solid #ddd;">
                <input id="tintStrength" type="range" min="0" max="100" value="0" style="margin-top:8px;">
                <div class="small">Add a color overlay (multiply) â€” useful for stylized looks.</div>
              </div>
            </div>
          </div>

          <div style="margin-top:14px;">
            <div class="section-title">ðŸ”„ Transform & Actions</div>
            <div class="grid-buttons">
              <button onclick="flip('horizontal')">Flip H</button>
              <button onclick="flip('vertical')">Flip V</button>
              <button onclick="rotate(-90)">Rotate Left</button>
              <button onclick="rotate(90)">Rotate Right</button>
              <button class="ghost wide" onclick="resetAll()">Reset</button>
              <button class="wide" onclick="downloadImage()">Download</button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">Pro tip: large images may take a moment to redraw. Want crop or sharpen? I can add them next.</div>
    </div>
  </div>

  <script>
    // ---------- state ----------
    const uploadEl = document.getElementById('upload');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // offscreen original canvas â€” we always draw from this to avoid cumulative edits
    const origCanvas = document.createElement('canvas');
    const octx = origCanvas.getContext('2d');

    let img = new Image();
    let presetFilter = 'none'; // CSS filter fragment for preset
    let angle = 0;
    let flipH = false, flipV = false;

    // UI elements
    const sliders = {
      brightness: document.getElementById('brightness'),
      contrast: document.getElementById('contrast'),
      saturation: document.getElementById('saturation'),
      hue: document.getElementById('hue'),
      blur: document.getElementById('blur'),
      tintColor: document.getElementById('tintColor'),
      tintStrength: document.getElementById('tintStrength'),
    };
    const labels = {
      brightnessVal: document.getElementById('brightnessVal'),
      contrastVal: document.getElementById('contrastVal'),
      saturationVal: document.getElementById('saturationVal'),
      hueVal: document.getElementById('hueVal'),
      blurVal: document.getElementById('blurVal'),
    };

    // update label helper
    function updateLabels(){
      labels.brightnessVal.textContent = sliders.brightness.value + '%';
      labels.contrastVal.textContent = sliders.contrast.value + '%';
      labels.saturationVal.textContent = sliders.saturation.value + '%';
      labels.hueVal.textContent = sliders.hue.value + 'Â°';
      labels.blurVal.textContent = sliders.blur.value + 'px';
    }

    // load image into origCanvas
    uploadEl.addEventListener('change', (e)=>{
      const file = e.target.files && e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        img = new Image();
        img.onload = () => {
          // store original into offscreen canvas (exact pixel size)
          origCanvas.width = img.width;
          origCanvas.height = img.height;
          octx.clearRect(0,0,origCanvas.width, origCanvas.height);
          octx.drawImage(img,0,0);

          // initialize working canvas to original size
          angle = 0;
          flipH = false; flipV = false;
          resetSliderUI(false); // set sliders to defaults but don't autosave to remote
          drawFromOriginal();
        };
        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    });


    // set preset (css string)
    function setPreset(str){
      presetFilter = str || 'none';
      drawFromOriginal();
    }

    // flip & rotate
    function flip(dir){
      if(!img.src) return;
      if(dir === 'horizontal') flipH = !flipH;
      else if(dir === 'vertical') flipV = !flipV;
      drawFromOriginal();
    }
    function rotate(deg){
      if(!img.src) return;
      angle = (angle + deg) % 360;
      drawFromOriginal();
    }

    // resets sliders to defaults; if redraw true, also redraw image
    function resetSliderUI(redraw = true){
      sliders.brightness.value = 100;
      sliders.contrast.value = 100;
      sliders.saturation.value = 100;
      sliders.hue.value = 0;
      sliders.blur.value = 0;
      sliders.tintStrength.value = 0;
      sliders.tintColor.value = '#ff7a7a';
      updateLabels();
      if(redraw) drawFromOriginal();
    }

    function resetAll(){
      presetFilter = 'none';
      angle = 0;
      flipH = false; flipV = false;
      resetSliderUI(true);
    }

    // Build CSS filter string from preset + sliders
    function buildFilterString(){
      const parts = [];
      if(presetFilter && presetFilter !== 'none') parts.push(presetFilter);
      parts.push(`brightness(${sliders.brightness.value}%)`);
      parts.push(`contrast(${sliders.contrast.value}%)`);
      parts.push(`saturate(${sliders.saturation.value}%)`);
      parts.push(`hue-rotate(${sliders.hue.value}deg)`);
      parts.push(`blur(${sliders.blur.value}px)`);
      return parts.join(' ');
    }

    // Draw routine: clears main canvas, sets canvas size to contain rotated image, applies transforms/filters
    function drawFromOriginal(){
      if(!img.src) return;

      // original image dimensions
      const ow = origCanvas.width;
      const oh = origCanvas.height;

      // compute bounding box for rotation so rotated image fits without cropping
      const rad = angle * Math.PI/180;
      const cos = Math.abs(Math.cos(rad));
      const sin = Math.abs(Math.sin(rad));
      const newW = Math.max(1, Math.round(ow * cos + oh * sin));
      const newH = Math.max(1, Math.round(ow * sin + oh * cos));

      // set canvas size (resets state)
      canvas.width = newW;
      canvas.height = newH;

      // clear and draw
      ctx.save();
      ctx.clearRect(0,0,canvas.width, canvas.height);

      // move to center
      ctx.translate(canvas.width/2, canvas.height/2);

      // apply rotation and flips
      const sx = flipH ? -1 : 1;
      const sy = flipV ? -1 : 1;
      ctx.scale(sx, sy);
      ctx.rotate(rad);

      // apply css filters
      ctx.filter = buildFilterString();

      // draw original offscreen canvas (centered)
      ctx.drawImage(origCanvas, -ow/2, -oh/2, ow, oh);

      ctx.restore();

      // apply tint overlay if requested (multiply)
      const tintStrength = Number(sliders.tintStrength.value) / 100;
      if(tintStrength > 0){
        ctx.save();
        ctx.globalCompositeOperation = 'multiply';
        ctx.globalAlpha = tintStrength;
        ctx.fillStyle = sliders.tintColor.value || '#ff7a7a';
        ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.restore();
      }

      // update labels
      updateLabels();
    }

    // Listen sliders and redraw immediately
    Object.values(sliders).forEach(el => {
      if(!el) return;
      el.addEventListener('input', ()=> {
        drawFromOriginal();
      });
    });

    // download function (saves current canvas)
    function downloadImage(){
      if(!img.src) return alert('No image loaded');
      // create link and download PNG
      const link = document.createElement('a');
      link.href = canvas.toDataURL('image/png');
      link.download = 'edited-photo.png';
      link.click();
    }

    // initial labels
    updateLabels();

    // expose helpers to window for button onclick usage
    window.setPreset = setPreset;
    window.flip = flip;
    window.rotate = rotate;
    window.resetAll = resetAll;
    window.downloadImage = downloadImage;
  </script>
</body>
</html>